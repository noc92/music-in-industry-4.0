<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Contract Preview</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Helvetica Neue', sans-serif;
      background-color: #f4f4f4;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 30px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      color: #f47959;
      margin-bottom: 40px;
    }

    .section-title {
      font-size: 18px;
      color: #555;
      margin-bottom: 10px;
      margin-top: 40px;
      border-bottom: 1px solid #eee;
      padding-bottom: 4px;
    }

    .pre-box {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
      overflow: auto;
      max-height: 600px;
      white-space: pre-wrap;
      border: 1px solid #ddd;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
    }

    .no-response {
      color: #888;
      font-style: italic;
    }

    /* ‚úçÔ∏è Signature section */
    .signature-section {
      margin-top: 40px;
    }

    #signature-pad {
      width: 100%;
      max-width: 500px;
      height: 200px;
      border: 2px solid #ccc;
      border-radius: 10px;
      background: #fff;
      display: block;
      margin-top: 10px;
    }

    .signature-buttons {
      margin-top: 15px;
    }

    .signature-buttons button {
      margin-right: 10px;
      padding: 10px 16px;
      border-radius: 6px;
      border: 2px solid #f47959;
      background: white;
      color: #f47959;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }

    .signature-buttons button:hover {
      background: #f47959;
      color: white;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>üìÑ Contract Viewer</h1>

  <div>
    <div class="section-title">üîπ Contract</div>
    {% if new_response %}
      <div class="pre-box"><pre>{{ new_response }}</pre></div>
    {% else %}
      <p class="no-response">No contract response yet.</p>
    {% endif %}
  </div>

  <div class="signature-section">
    <div class="section-title">‚úçÔ∏è Electronic Signature</div>
    <canvas id="signature-pad"></canvas>
    <div class="signature-buttons">
      <button onclick="clearPad()">üßΩ Clear</button>
      <button onclick="submitSignature()">‚úÖ Submit Signature</button>
    </div>
  </div>
</div>

<script>
  const canvas = document.getElementById('signature-pad');
  const ctx = canvas.getContext('2d');
  let drawing = false;

  canvas.addEventListener('mousedown', () => drawing = true);
  canvas.addEventListener('mouseup', () => {
    drawing = false;
    ctx.beginPath();
  });
  canvas.addEventListener('mousemove', draw);

  function draw(event) {
    if (!drawing) return;
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#333';
    ctx.lineTo(event.offsetX, event.offsetY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(event.offsetX, event.offsetY);
  }

  function clearPad() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  function submitSignature() {
    const dataUrl = canvas.toDataURL('image/png');

    fetch("{% url 'submit_signature' %}", {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify({ signature: dataUrl })
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === 'success') {
        alert("üìù Signature saved successfully!");
        window.location.href = "{% url 'chatbot' %}";
      } else {
        alert("‚ùå Failed to save signature.");
      }
    });
  }
</script>

</body>
</html>
